<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Leaderboard - Activity Tracker</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="app">
  <%- include('partials/header', { activePage:'leaderboard', user:{ id: (rows[0]&&rows[0].userId) ? rows[0].userId : null } }) %>

  <main class="app-main" style="grid-template-columns:1fr;">
    <section class="card" style="display:flex; flex-direction:column; gap:1rem;">
      <h1 class="page-title" style="font-size:1.5rem;">Leaderboard</h1>
      <p class="subtle" style="margin-top:-.5rem;">Total meters (sum of all entry values) per user.</p>
      <ul class="leaderboard-list">
        <% rows.forEach(function(r){ const pct = max? (r.total / max * 100):0; %>
          <li class="lb-row" data-pct="<%= pct.toFixed(2) %>" data-primary="<%= r.shellPrimary %>" data-secondary="<%= r.shellSecondary %>" data-oar="<%= r.oarColor %>">
            <div class="lb-track">
              <div class="lb-fill"></div>
              <div class="lb-marker">
                <span class="lb-info"><span class="lb-name"><%= r.name %></span>&nbsp;â€¢&nbsp;<span class="lb-meters"><%= Number(r.total).toLocaleString('en-US') %> m</span></span>
                <svg class="lb-shell" viewBox="0 0 300 110" preserveAspectRatio="xMidYMid meet">
                  <g transform="translate(0,110) scale(0.1,-0.1)" stroke="none">
                    <path class="oar" fill="<%= r.oarColor || '#FF4F4F' %>" d="M1161 1018 c7 -13 37 -53 68 -90 31 -37 81 -99 111 -138 30 -39 75 -96 100 -128 25 -31 55 -71 67 -88 l21 -31 -33 -44 c-50 -65 -132 -170 -195 -247 -30 -38 -68 -85 -85 -107 -16 -21 -41 -51 -53 -67 -13 -15 -20 -28 -14 -28 12 0 482 477 482 489 0 5 -84 97 -186 203 -103 106 -207 217 -232 246 -48 54 -71 68 -51 30z"/>
                    <path class="primary primary1" fill="<%= r.shellPrimary || '#2E7BCB' %>" d="M1235 640 c-38 -4 -113 -10 -165 -14 -52 -4 -162 -13 -245 -21 -253 -25 -503 -45 -563 -46 -62 0 -108 -13 -82 -22 8 -3 69 -8 135 -11 66 -4 136 -8 155 -11 19 -2 145 -13 280 -25 135 -11 262 -22 283 -25 21 -2 98 -8 172 -11 116 -6 135 -5 135 8 0 8 -11 25 -25 38 -14 13 -25 29 -25 36 0 20 39 82 55 88 8 3 15 10 15 16 0 11 -19 11 -125 0z m30 -50 c4 -6 2 -17 -4 -24 -6 -7 -8 -27 -5 -45 l7 -31 -99 5 c-55 4 -130 10 -169 15 -38 5 -106 12 -149 16 -44 4 -91 10 -105 14 -24 6 -23 7 14 13 22 4 94 12 160 18 105 10 153 14 312 26 18 2 35 -2 38 -7z"/>
                    <path class="primary primary2" fill="<%= r.shellPrimary || '#2E7BCB' %>" d="M1690 642 c0 -5 14 -26 30 -47 17 -21 30 -45 30 -53 0 -8 -17 -35 -37 -60 l-37 -45 80 6 c43 4 138 12 209 17 72 6 150 12 175 15 25 2 77 7 115 10 39 3 90 8 115 11 178 17 389 34 433 34 28 0 58 4 66 9 17 11 -8 14 -309 36 -118 8 -258 20 -310 25 -52 6 -187 17 -300 25 -113 8 -217 18 -232 21 -16 3 -28 1 -28 -4z m300 -62 c373 -29 403 -43 135 -65 -38 -3 -90 -8 -115 -10 -25 -3 -86 -7 -136 -11 l-90 -5 0 50 0 51 35 0 c20 0 97 -5 171 -10z"/>
                    <path class="secondary secondary1" fill="<%= r.shellSecondary || '#FFD447' %>" d="M1265 590 c4 -6 2 -17 -4 -24 -6 -7 -8 -27 -5 -45 l7 -31 -99 5 c-55 4 -130 10 -169 15 -38 5 -106 12 -149 16 -44 4 -91 10 -105 14 -24 6 -23 7 14 13 22 4 94 12 160 18 105 10 153 14 312 26 18 2 35 -2 38 -7 z"/>
                    <path class="secondary secondary2" fill="<%= r.shellSecondary || '#FFD447' %>" d="M1990 580 c373 -29 403 -43 135 -65 -38 -3 -90 -8 -115 -10 -25 -3 -86 -7 -136 -11 l-90 -5 0 50 0 51 35 0 c20 0 97 -5 171 -10z"/>
                  </g>
                </svg>
              </div>
            </div>
          </li>
        <% }); %>
      </ul>
    </section>
  </main>
  <footer class="app-footer"><small>&copy; <span id="year"></span></small></footer>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    const btn = document.getElementById('toggleTheme'); const stored = localStorage.getItem('theme'); if(stored){document.documentElement.dataset.theme=stored;} btn.addEventListener('click',()=>{const next=document.documentElement.dataset.theme==='dark'?'light':'dark';document.documentElement.dataset.theme=next;localStorage.setItem('theme',next);});
  </script>
  <script>
  (function(){
    function hexToRgba(h,a){const r=parseInt(h.slice(1,3),16),g=parseInt(h.slice(3,5),16),b=parseInt(h.slice(5,7),16);return `rgba(${r},${g},${b},${a})`;}
    function update(){
      document.querySelectorAll('.lb-row').forEach(row=>{
        const track=row.querySelector('.lb-track');
        const marker=row.querySelector('.lb-marker');
        const fill=row.querySelector('.lb-fill');
        if(!track||!marker||!fill) return;
        const pct=parseFloat(row.dataset.pct||'0');
        const secondary=row.dataset.secondary||'#FFD447';
        const markerW=marker.offsetWidth;
        const usable=track.clientWidth-markerW;
        const leftPx=usable*(pct/100)+markerW/2;
        marker.style.left=leftPx+'px';
        const gradMid = hexToRgba(secondary,0.20);
        const gradEnd = hexToRgba(secondary,0.35);
        fill.style.background=`linear-gradient(90deg, ${gradEnd} 0%, ${gradMid} 55%, transparent 100%)`;
        fill.style.width=(leftPx + markerW*0.25)+'px';
      });
    }
    window.addEventListener('resize',update); update();
  })();
  </script>
</body>
</html>